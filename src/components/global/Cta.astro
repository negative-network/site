---
import { Image } from "astro:assets";
import img from "@assets/images/contact-paperplane.svg";
---

<section id="contact" class="scrolled-to bg-zinc-100">
  <div
    class="flex-col items-center justify-center px-4 py-10 mx-auto md:p-40 w-full md:max-w-[40%] 2xl:max-w-[80%]"
  >
    <h2
      class="text-center text-4xl font-medium tracking-tight text-black md:text-5xl font-display"
    >
      Nous contacter
    </h2>

    <p class="my-10 text-gray-300 font-normal text-center mx-auto">
      Réponse sous 48h ouvrées maximum !
    </p>

    <div
      class="grid grid-cols-1 md:grid-cols-12 [grid-template-areas:'image''form'] md:[grid-template-areas:'form''image']"
    >
      <div class="md:col-span-8 [grid-area: form]">
        <form
          id="my-form"
          action="https://formspree.io/f/xdknkqyz"
          method="POST"
          class="flex flex-col p-2 mx-auto child:mb-4 child:rounded-md w-4/5"
        >
          <input
            type="email"
            name="email"
            class="text-black border-gray-300"
            id="email"
            placeholder="Votre adresse mail"
            required
          />
          <textarea
            name="message"
            rows="7"
            class="text-black border-gray-300"
            id="message"
            placeholder="Votre message"
            required></textarea>
          <button
            id="my-form-button"
            class="px-4 py-2 text-white bg-black rounded hover:bg-white hover:text-black"
            >Envoyer</button
          >
          <p id="my-form-status"></p>
        </form>
      </div>

      <div
        class="md:col-span-4 [grid-area: image] flex items-center justify-center md:justify-start"
      >
        <Image
          src={img}
          alt="Paperplane"
          id="paperplane"
          class:list={"w-20 md:w-40 h-auto"}
        />
      </div>
    </div>

    <script>
      let form = document.getElementById("my-form") as HTMLFormElement;
      let paperplane = document.getElementById(
        "paperplane"
      ) as HTMLImageElement;

// //shake paperplane
// setInterval(() => {
//   paperplane.style.transform = "rotate(1deg)";
//   setTimeout(() => {
//     paperplane.style.transform = "rotate(-1deg)";
//   }, 100);
// }, 200);

              // //move paperplane slowly outside of the screen
              // let position = 0;
              // setInterval(() => {
              //   position += 1;
              //   // paperplane.style.transform = `translate(${2 * position}px, ${-position}px)  rotate(${position}deg)`;
              //   paperplane.style.transform = `translate(${2 * position}px, ${-position}px)`;
              // }, 5);

      async function handleSubmit(event) {
        event.preventDefault();

        let status = document.getElementById("my-form-status");
        let data = new FormData(event.target);
        fetch(event.target.action, {
          method: form.method,
          body: data,
          headers: {
            Accept: "application/json",
          },
        })
          .then((response) => {
            if (response.ok) {


              status.innerHTML = "Votre message a bien été envoyé !";
              form.reset();
            } else {
              response.json().then((data) => {
                if (Object.hasOwn(data, "errors")) {
                  status.innerHTML = data["errors"]
                    .map((error) => error["message"])
                    .join(", ");
                } else {
                  status.innerHTML =
                    "Hmm, il y a eu un problème. Veuillez réessayer.";
                }
              });
            }
          })
          .catch((error) => {
            status.innerHTML =
              "Hmm, il y a eu un problème. Vous pouvez nous contacter directement à l'adresse contact@negative-network.com";
          });
      }
      form.addEventListener("submit", handleSubmit);
    </script>
  </div>
</section>
